<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.2.xsd">

    
    <changeSet id="#1102_20160823" author="rachidAityaazza">
        <createSequence sequenceName="CUST_CRT_SEQ"/>

        <createTable tableName="CUST_CRT">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="disabled" type="${type.boolean}">
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="description" type="VARCHAR(100)" />
            <column name="code" type="VARCHAR(50)" />
            <column name="provider_id" type="BIGINT" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />

            <column name="name" type="VARCHAR(100)" />
            <column name="direction" type="VARCHAR(100)" />
            <column name="start_node_id" type="BIGINT" />
            <column name="end_node_id" type="BIGINT" />
            <column name="start_node_keys" type="VARCHAR(100)" />
            <column name="end_node_keys" type="VARCHAR(100)" />
        </createTable>

        <addPrimaryKey columnNames="id" constraintName="cust_crt_pkey"
            tableName="cust_crt" />

        <addForeignKeyConstraint baseColumnNames="provider_id"
            baseTableName="cust_crt" constraintName="fk_cust_crt_crm_provider"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
            onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="crm_provider" />

        <addForeignKeyConstraint baseColumnNames="start_node_id"
            baseTableName="cust_crt" constraintName="fk_cust_crt_start_node"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
            onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cust_cet"/>

        <addForeignKeyConstraint baseColumnNames="end_node_id"
            baseTableName="cust_crt" constraintName="fk_cust_crt_end_node"
            deferrable="false" initiallyDeferred="false" onDelete="NO ACTION"
            onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="cust_cet"/>

    </changeSet>
    <changeSet id="#1150_20161010" author="rachidAityaazza" failOnError="false">
		<addColumn tableName="crm_custom_field_tmpl">
            <column name="is_unique" type="${type.boolean}" defaultValueNumeric="0"/>
            <column name="is_filter" type="${type.boolean}" defaultValueNumeric="0"/>
            <column name="expression_separator" type="VARCHAR(100)"/>
		</addColumn>
	</changeSet>
	<changeSet id="#2289_20170202" author="rachidAityaazza"> 
        <modifyDataType tableName="CRM_CUSTOM_FIELD_TMPL" columnName="INDEX_TYPE" newDataType="VARCHAR(250)"/>
    </changeSet> 
    <changeSet id="#2289_20170203" author="rachidAityaazza"> 
        <modifyDataType tableName="CUST_CEI" columnName="CODE" newDataType="VARCHAR(250)"/>
    </changeSet>
    <changeSet id="#2290_20170524" author="pbach">
        <createSequence sequenceName="IEP_REGION_SEQ"/>

        <createTable tableName="IEP_REGION">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="updated" type="datetime" />
            <column name="disabled" type="${type.boolean}" defaultValueNumeric="0">
                <constraints nullable="false"/>
            </column>
            <column name="region_code" type="VARCHAR(50)" />
            <column name="description_en" type="VARCHAR(100)" />
            <column name="description_fr" type="VARCHAR(100)" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
        </createTable>
        <addPrimaryKey columnNames="id" constraintName="iep_region_pkey"
                       tableName="IEP_REGION" />

        <createTable tableName="IEP_REGION_COUNTRY">
            <column name="region_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="country_id" type="BIGINT">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addPrimaryKey columnNames="region_id, country_id" constraintName="iep_region_country_pkey" tableName="IEP_REGION_COUNTRY" />
        <addForeignKeyConstraint baseColumnNames="region_id" baseTableName="IEP_REGION_COUNTRY" constraintName="fk_iep_region_country_region" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="IEP_REGION" />
        <addForeignKeyConstraint baseColumnNames="country_id" baseTableName="IEP_REGION_COUNTRY" constraintName="fk_iep_region_country_country" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION" referencedColumnNames="id" referencedTableName="ADM_COUNTRY" />

         <!--<sql>-->
            <!--INSERT INTO IEP_REGION (id, version, created, updated, region_code, description_en, description_fr, creator, updater) VALUES (1, 0, '2017-05-24 07:46:20.404', NULL, 'AS', 'Asia', 'Asie', 1, NULL);-->
            <!--INSERT INTO IEP_REGION (id, version, created, updated, region_code, description_en, description_fr, creator, updater) VALUES (2, 0, '2017-05-24 07:46:20.404', NULL, 'NA,', 'North America,', 'Amérique du nord', 1, NULL);-->
            <!--INSERT INTO IEP_REGION (id, version, created, updated, region_code, description_en, description_fr, creator, updater) VALUES (3, 0, '2017-05-24 07:46:20.404', NULL, 'SA', 'South America', 'Amérique du sud', 1, NULL);-->
            <!--INSERT INTO IEP_REGION (id, version, created, updated, region_code, description_en, description_fr, creator, updater) VALUES (4, 0, '2017-05-24 07:46:20.404', NULL, 'EU', 'Europe', 'Europe', 1, NULL);-->
            <!--INSERT INTO IEP_REGION (id, version, created, updated, region_code, description_en, description_fr, creator, updater) VALUES (5, 0, '2017-05-24 07:46:20.404', NULL, 'AF', 'Africa', 'Afrique', 1, NULL);-->
            <!--INSERT INTO IEP_REGION (id, version, created, updated, region_code, description_en, description_fr, creator, updater) VALUES (6, 0, '2017-05-24 07:46:20.404', NULL, 'AN', 'Antarctica', 'Antarctique', 1, NULL);-->
            <!--INSERT INTO IEP_REGION (id, version, created, updated, region_code, description_en, description_fr, creator, updater) VALUES (7, 0, '2017-05-24 07:46:20.404', NULL, 'AU', 'Australia', 'Australie', 1, NULL);-->
            <!--INSERT INTO IEP_REGION (id, version, created, updated, region_code, description_en, description_fr, creator, updater) VALUES (8, 0, '2017-05-24 07:46:20.404', NULL, 'OC', 'Oceania', 'Océanie', 1, NULL);-->
        <!--</sql>-->
    </changeSet>
    <changeSet id="technical_services" author="Clément Bareth">
        <!-- Technical Services -->
        <createSequence sequenceName="technical_services_seq"/>
        <createTable tableName="technical_services">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="version" type="INT4" />
            <column name="service_version" type="INT4" >
                <constraints nullable="false" />
            </column>
            <column name="created" type="datetime">
                <constraints nullable="false" />
            </column>
            <column name="disabled" type="INT4"/>
            <column name="updated" type="datetime" />
            <column name="creator" type="varchar(100)" />
            <column name="updater" type="varchar(100)" />
            <column name="description" type="varchar(255)" />
            <column name="code" type="varchar(255)" />
            <column name="script" type="${type.longtext}">
                <constraints nullable="false" />
            </column>
            <column name="name" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="service_type" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="technical_services" columnNames="id"/>
        <addUniqueConstraint columnNames="name,service_version" constraintName="technical_services_name_version"
                             deferrable="false" disabled="false" initiallyDeferred="false"
                             tableName="technical_services"/>
        <createIndex tableName="technical_services" indexName="technical_services_name_index">
            <column name="name"/>
        </createIndex>
        <!-- Descriptions -->
        <createSequence sequenceName="technical_services_description_seq"/>
        <createTable tableName="technical_services_description">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="description_type" type="varchar(255)"/>
            <column name="service_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="input" defaultValue="false" type="boolean"/>
            <column name="output" defaultValue="false" type="boolean"/>
            <column name="entity_name" type="varchar(255)" />
            <column name="target_name" type="varchar(255)" />
            <column name="source_name" type="varchar(255)" />
            <column name="cet_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="crt_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addPrimaryKey tableName="technical_services_description" columnNames="id" />
        <addForeignKeyConstraint baseTableName="technical_services_description" baseColumnNames="service_id"
                                 constraintName="fk_ts_desc_service_id" referencedTableName="technical_services"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="technical_services_description" baseColumnNames="cet_id"
                                 constraintName="fk_ts_cet_id" referencedTableName="cust_cet"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="technical_services_description" baseColumnNames="crt_id"
                                 constraintName="fk_ts_crt_id" referencedTableName="cust_crt"
                                 referencedColumnNames="id"/>
        <!-- Property description -->
        <createSequence sequenceName="property_description_seq"/>
        <createTable tableName="property_description">
            <column name="id" type="BIGINT">
                <constraints nullable="false" />
            </column>
            <column name="description_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="cft_id" type="BIGINT">
                <constraints nullable="false"/>
            </column>
            <column name="required" defaultValue="false" type="boolean"/>
            <column name="comparator" type="varchar(255)"/>
            <column name="comparison_value" type="varchar(255)"/>
            <column name="default_value" type="varchar(255)"/>
            <column name="trustness" type="INT"/>
            <column name="direction" type="varchar(255)"/>
        </createTable>
        <addPrimaryKey tableName="property_description" columnNames="id" />
        <addForeignKeyConstraint baseTableName="property_description" baseColumnNames="cft_id"
                                 constraintName="fk_prop_desc_cft_id" referencedTableName="crm_custom_field_tmpl"
                                 referencedColumnNames="id"/>
        <addForeignKeyConstraint baseTableName="property_description" baseColumnNames="description_id"
                                 constraintName="fk_prop_desc_desc_id" referencedTableName="technical_services_description"
                                 referencedColumnNames="id"/>
    </changeSet>

</databaseChangeLog>